<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Founder Dashboard Chart Test</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --bg-primary: #0f172a;
      --bg-secondary: #1e293b;
      --bg-tertiary: #334155;
      --text-primary: #f1f5f9;
      --text-secondary: #cbd5e1;
      --border: #334155;
      --accent: #8B5CF6;
    }

    body {
      font-family: 'Inter', sans-serif;
      background: var(--bg-primary);
      color: var(--text-primary);
      padding: 40px;
      min-height: 100vh;
    }

    h1 {
      font-size: 24px;
      margin-bottom: 10px;
      color: var(--text-primary);
    }

    .test-info {
      background: var(--bg-secondary);
      padding: 20px;
      border-radius: 12px;
      margin-bottom: 30px;
      border: 1px solid var(--border);
    }

    .test-info h2 {
      font-size: 16px;
      margin-bottom: 10px;
      color: var(--accent);
    }

    .test-info p {
      font-size: 14px;
      color: var(--text-secondary);
      margin-bottom: 8px;
    }

    .charts-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 24px;
      margin-bottom: 30px;
    }

    .chart-section {
      background: var(--bg-secondary);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 20px;
    }

    .chart-section h3 {
      font-size: 14px;
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: 16px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .chart-container {
      background: var(--bg-tertiary);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 16px;
      min-height: 200px;
      position: relative;
    }

    .chart-canvas {
      width: 100% !important;
      height: 200px !important;
      display: block;
    }

    .test-results {
      background: var(--bg-secondary);
      padding: 20px;
      border-radius: 12px;
      border: 1px solid var(--border);
    }

    .test-results h2 {
      font-size: 16px;
      margin-bottom: 15px;
      color: var(--accent);
    }

    .test-item {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 10px;
      margin-bottom: 8px;
      background: var(--bg-tertiary);
      border-radius: 8px;
    }

    .test-item.pass {
      border-left: 3px solid #10B981;
    }

    .test-item.fail {
      border-left: 3px solid #EF4444;
    }

    .test-status {
      font-size: 12px;
      font-weight: 600;
      padding: 4px 8px;
      border-radius: 4px;
    }

    .test-status.pass {
      background: #10B981;
      color: white;
    }

    .test-status.fail {
      background: #EF4444;
      color: white;
    }

    .chart-status {
      position: absolute;
      top: 10px;
      right: 10px;
      font-size: 11px;
      padding: 4px 8px;
      border-radius: 4px;
      background: rgba(0, 0, 0, 0.5);
    }

    .chart-status.visible {
      color: #10B981;
    }

    .chart-status.hidden {
      color: #EF4444;
    }
  </style>
</head>
<body>
  <h1>Founder Dashboard Chart Test Page</h1>

  <div class="test-info">
    <h2>Test Objective</h2>
    <p><strong>Goal:</strong> Verify all charts render with visible grid lines, axes, and labels even with zero data</p>
    <p><strong>Expected:</strong> Each chart should display its structure (not be completely blank/black)</p>
    <p><strong>Data:</strong> All charts initialized with zero values (empty state)</p>
  </div>

  <div class="charts-grid">
    <!-- Growth Chart -->
    <div class="chart-section" data-chart="growth">
      <h3>üìà 30-Day Growth Trend</h3>
      <div class="chart-container">
        <canvas id="growthChart" class="chart-canvas"></canvas>
        <div class="chart-status" id="growthStatus">Initializing...</div>
      </div>
    </div>

    <!-- MRR Chart -->
    <div class="chart-section" data-chart="mrr">
      <h3>üí∞ 2026 MRR Overview</h3>
      <div class="chart-container">
        <canvas id="mrrChart" class="chart-canvas"></canvas>
        <div class="chart-status" id="mrrStatus">Initializing...</div>
      </div>
    </div>

    <!-- Conversion Chart -->
    <div class="chart-section" data-chart="conversion">
      <h3>üë• Monthly Conversion Rate</h3>
      <div class="chart-container">
        <canvas id="conversionChart" class="chart-canvas"></canvas>
        <div class="chart-status" id="conversionStatus">Initializing...</div>
      </div>
    </div>

    <!-- Detection Chart -->
    <div class="chart-section" data-chart="detection">
      <h3>üõ°Ô∏è Detection Breakdown</h3>
      <div class="chart-container">
        <canvas id="detectionChart" class="chart-canvas"></canvas>
        <div class="chart-status" id="detectionStatus">Initializing...</div>
      </div>
    </div>
  </div>

  <div class="test-results">
    <h2>Automated Test Results</h2>
    <div id="testResultsContainer">
      <p style="color: var(--text-secondary);">Running tests...</p>
    </div>
  </div>

  <script>
    console.log('[Chart Test] Starting initialization...');
    console.log('[Chart Test] Chart.js loaded:', typeof Chart !== 'undefined');

    // Wait for Chart.js to be fully loaded
    function waitForChartJS() {
      return new Promise((resolve) => {
        if (typeof Chart !== 'undefined') {
          console.log('[Chart Test] Chart.js already loaded');
          resolve();
        } else {
          console.log('[Chart Test] Waiting for Chart.js...');
          const checkInterval = setInterval(() => {
            if (typeof Chart !== 'undefined') {
              console.log('[Chart Test] Chart.js now loaded');
              clearInterval(checkInterval);
              resolve();
            }
          }, 100);
        }
      });
    }

    // Test results tracking
    const testResults = {
      growthChart: { created: false, visible: false, hasAxes: false },
      mrrChart: { created: false, visible: false, hasAxes: false },
      conversionChart: { created: false, visible: false, hasAxes: false },
      detectionChart: { created: false, visible: false, hasAxes: false }
    };

    let chartInstances = {};

    // Initialize all charts
    async function initializeCharts() {
      await waitForChartJS();
      console.log('[Chart Test] Initializing charts with zero data...');

      // Generate 30 days of zero data
      const labels30Days = [];
      for (let i = 29; i >= 0; i--) {
        const date = new Date();
        date.setDate(date.getDate() - i);
        labels30Days.push(date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' }));
      }

      // Generate 12 months
      const monthNames = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
      const currentMonth = new Date().getMonth();
      const labelsYTD = monthNames.slice(0, currentMonth + 1);

      const gridColor = 'rgba(255, 255, 255, 0.1)';
      const textColor = 'rgba(255, 255, 255, 0.6)';

      // 1. Growth Chart
      try {
        const ctx1 = document.getElementById('growthChart');
        if (ctx1) {
          chartInstances.growthChart = new Chart(ctx1, {
            type: 'line',
            data: {
              labels: labels30Days,
              datasets: [
                {
                  label: 'Active Users',
                  data: labels30Days.map(() => 0),
                  borderColor: '#8B5CF6',
                  backgroundColor: 'rgba(139, 92, 246, 0.1)',
                  fill: true,
                  tension: 0.4,
                  pointRadius: 3,
                  pointHoverRadius: 5,
                },
                {
                  label: 'Scans',
                  data: labels30Days.map(() => 0),
                  borderColor: '#10B981',
                  backgroundColor: 'rgba(16, 185, 129, 0.1)',
                  fill: true,
                  tension: 0.4,
                  pointRadius: 3,
                  pointHoverRadius: 5,
                }
              ]
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              plugins: {
                legend: {
                  display: true,
                  position: 'top',
                  labels: {
                    boxWidth: 12,
                    padding: 10,
                    color: textColor,
                    font: { size: 11 }
                  }
                }
              },
              scales: {
                x: {
                  grid: { color: gridColor, display: true },
                  ticks: {
                    color: textColor,
                    font: { size: 10 },
                    maxTicksLimit: 7
                  }
                },
                y: {
                  grid: { color: gridColor, display: true },
                  ticks: {
                    color: textColor,
                    font: { size: 10 }
                  },
                  beginAtZero: true,
                  suggestedMax: 10
                }
              }
            }
          });
          testResults.growthChart.created = true;
          updateChartStatus('growthStatus', 'Created', 'visible');
          console.log('[Chart Test] Growth chart created successfully');
        }
      } catch (error) {
        console.error('[Chart Test] Growth chart error:', error);
        updateChartStatus('growthStatus', 'Failed', 'hidden');
      }

      // 2. MRR Chart
      try {
        const ctx2 = document.getElementById('mrrChart');
        if (ctx2) {
          chartInstances.mrrChart = new Chart(ctx2, {
            type: 'bar',
            data: {
              labels: monthNames,
              datasets: [
                {
                  label: 'Actual MRR',
                  data: monthNames.map((_, i) => i <= currentMonth ? 0 : null),
                  backgroundColor: '#10B981',
                  borderRadius: 6,
                  barPercentage: 0.7,
                },
                {
                  label: 'Projected MRR',
                  data: monthNames.map((_, i) => i > currentMonth ? 0 : null),
                  backgroundColor: 'rgba(16, 185, 129, 0.3)',
                  borderRadius: 6,
                  borderDash: [5, 5],
                  barPercentage: 0.7,
                }
              ]
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              plugins: {
                legend: {
                  display: true,
                  position: 'top',
                  labels: {
                    boxWidth: 12,
                    padding: 10,
                    color: textColor,
                    font: { size: 11 }
                  }
                }
              },
              scales: {
                x: {
                  grid: { display: false },
                  ticks: {
                    color: textColor,
                    font: { size: 10 }
                  }
                },
                y: {
                  grid: { color: gridColor, display: true },
                  ticks: {
                    color: textColor,
                    font: { size: 10 },
                    callback: function(value) {
                      return '$' + value;
                    }
                  },
                  beginAtZero: true,
                  suggestedMax: 100
                }
              }
            }
          });
          testResults.mrrChart.created = true;
          updateChartStatus('mrrStatus', 'Created', 'visible');
          console.log('[Chart Test] MRR chart created successfully');
        }
      } catch (error) {
        console.error('[Chart Test] MRR chart error:', error);
        updateChartStatus('mrrStatus', 'Failed', 'hidden');
      }

      // 3. Conversion Chart
      try {
        const ctx3 = document.getElementById('conversionChart');
        if (ctx3) {
          chartInstances.conversionChart = new Chart(ctx3, {
            type: 'line',
            data: {
              labels: labelsYTD,
              datasets: [{
                label: 'Conversion Rate',
                data: labelsYTD.map(() => 0),
                borderColor: '#8B5CF6',
                backgroundColor: 'rgba(139, 92, 246, 0.1)',
                fill: true,
                tension: 0.4,
                pointBackgroundColor: '#8B5CF6',
                pointBorderColor: '#ffffff',
                pointBorderWidth: 2,
                pointRadius: 4,
                pointHoverRadius: 6
              }]
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              plugins: {
                legend: { display: false }
              },
              scales: {
                x: {
                  grid: { display: false },
                  ticks: {
                    color: textColor,
                    font: { size: 10 }
                  }
                },
                y: {
                  grid: { color: gridColor, display: true },
                  ticks: {
                    color: textColor,
                    font: { size: 10 },
                    callback: function(value) {
                      return value + '%';
                    }
                  },
                  beginAtZero: true,
                  suggestedMax: 10
                }
              }
            }
          });
          testResults.conversionChart.created = true;
          updateChartStatus('conversionStatus', 'Created', 'visible');
          console.log('[Chart Test] Conversion chart created successfully');
        }
      } catch (error) {
        console.error('[Chart Test] Conversion chart error:', error);
        updateChartStatus('conversionStatus', 'Failed', 'hidden');
      }

      // 4. Detection Chart (Doughnut)
      try {
        const ctx4 = document.getElementById('detectionChart');
        if (ctx4) {
          // For doughnut charts with all zeros, we need at least some data to show structure
          // Use small values that will show the segments
          chartInstances.detectionChart = new Chart(ctx4, {
            type: 'doughnut',
            data: {
              labels: ['Legitimate', 'Scam', 'Ghost', 'Spam'],
              datasets: [{
                data: [1, 1, 1, 1], // Equal segments to show structure
                backgroundColor: ['#10B981', '#EF4444', '#F59E0B', '#8B5CF6'],
                borderWidth: 2,
                borderColor: '#1e293b',
                hoverOffset: 4
              }]
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              cutout: '65%',
              plugins: {
                legend: {
                  display: true,
                  position: 'bottom',
                  labels: {
                    boxWidth: 12,
                    padding: 10,
                    color: textColor,
                    font: { size: 11 }
                  }
                },
                tooltip: {
                  callbacks: {
                    label: function(context) {
                      return context.label + ': 0 (Empty State)';
                    }
                  }
                }
              }
            }
          });
          testResults.detectionChart.created = true;
          updateChartStatus('detectionStatus', 'Created', 'visible');
          console.log('[Chart Test] Detection chart created successfully');
        }
      } catch (error) {
        console.error('[Chart Test] Detection chart error:', error);
        updateChartStatus('detectionStatus', 'Failed', 'hidden');
      }

      // Run visibility tests after short delay
      setTimeout(runVisibilityTests, 500);
    }

    function updateChartStatus(statusId, text, className) {
      const el = document.getElementById(statusId);
      if (el) {
        el.textContent = text;
        el.className = 'chart-status ' + className;
      }
    }

    function runVisibilityTests() {
      console.log('[Chart Test] Running visibility tests...');

      const tests = [
        {
          name: 'Growth Chart Rendered',
          check: () => {
            const canvas = document.getElementById('growthChart');
            const isVisible = canvas && canvas.offsetHeight > 0 && canvas.offsetWidth > 0;
            const hasInstance = !!chartInstances.growthChart;
            testResults.growthChart.visible = isVisible && hasInstance;
            return isVisible && hasInstance;
          }
        },
        {
          name: 'MRR Chart Rendered',
          check: () => {
            const canvas = document.getElementById('mrrChart');
            const isVisible = canvas && canvas.offsetHeight > 0 && canvas.offsetWidth > 0;
            const hasInstance = !!chartInstances.mrrChart;
            testResults.mrrChart.visible = isVisible && hasInstance;
            return isVisible && hasInstance;
          }
        },
        {
          name: 'Conversion Chart Rendered',
          check: () => {
            const canvas = document.getElementById('conversionChart');
            const isVisible = canvas && canvas.offsetHeight > 0 && canvas.offsetWidth > 0;
            const hasInstance = !!chartInstances.conversionChart;
            testResults.conversionChart.visible = isVisible && hasInstance;
            return isVisible && hasInstance;
          }
        },
        {
          name: 'Detection Chart Rendered',
          check: () => {
            const canvas = document.getElementById('detectionChart');
            const isVisible = canvas && canvas.offsetHeight > 0 && canvas.offsetWidth > 0;
            const hasInstance = !!chartInstances.detectionChart;
            testResults.detectionChart.visible = isVisible && hasInstance;
            return isVisible && hasInstance;
          }
        },
        {
          name: 'All Charts Have Grid Lines',
          check: () => {
            // Check if charts are actually drawing something
            return Object.keys(chartInstances).length === 4;
          }
        }
      ];

      const container = document.getElementById('testResultsContainer');
      container.innerHTML = '';

      let passCount = 0;
      tests.forEach(test => {
        const passed = test.check();
        if (passed) passCount++;

        const div = document.createElement('div');
        div.className = 'test-item ' + (passed ? 'pass' : 'fail');
        div.innerHTML = `
          <span class="test-status ${passed ? 'pass' : 'fail'}">${passed ? 'PASS' : 'FAIL'}</span>
          <span>${test.name}</span>
        `;
        container.appendChild(div);
      });

      // Overall result
      const overallDiv = document.createElement('div');
      overallDiv.className = 'test-item ' + (passCount === tests.length ? 'pass' : 'fail');
      overallDiv.innerHTML = `
        <span class="test-status ${passCount === tests.length ? 'pass' : 'fail'}">
          ${passCount}/${tests.length}
        </span>
        <span><strong>Overall Test Result: ${passCount === tests.length ? '100% PASS ‚úì' : 'INCOMPLETE'}</strong></span>
      `;
      overallDiv.style.marginTop = '10px';
      overallDiv.style.borderTop = '1px solid var(--border)';
      overallDiv.style.paddingTop = '10px';
      container.appendChild(overallDiv);

      console.log('[Chart Test] Tests complete:', passCount, '/', tests.length);
      console.log('[Chart Test] Results:', testResults);

      // Expose results for Playwright
      window.chartTestResults = {
        passCount,
        totalTests: tests.length,
        passRate: (passCount / tests.length) * 100,
        details: testResults,
        chartInstances: Object.keys(chartInstances)
      };
    }

    // Initialize on page load
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initializeCharts);
    } else {
      initializeCharts();
    }
  </script>
</body>
</html>
