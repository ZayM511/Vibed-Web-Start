<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Founder Dashboard Test - Charts Verification</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cormorant:wght@400;500;600&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <style>
    :root {
      --bg-primary: #0f0f12;
      --bg-secondary: #18181b;
      --bg-tertiary: #27272a;
      --text-primary: #fafafa;
      --text-secondary: #a1a1aa;
      --text-tertiary: #71717a;
      --border: #3f3f46;
      --accent: #8B5CF6;
      --accent-subtle: rgba(139, 92, 246, 0.1);
      --success: #10B981;
      --danger: #EF4444;
      --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.3);
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: "Inter", -apple-system, BlinkMacSystemFont, sans-serif;
      background: var(--bg-primary);
      color: var(--text-primary);
      min-height: 100vh;
      padding: 20px;
    }

    .test-header {
      text-align: center;
      padding: 20px;
      margin-bottom: 20px;
      background: var(--bg-secondary);
      border-radius: 12px;
      border: 1px solid var(--border);
    }

    .test-header h1 {
      font-family: "Cormorant", serif;
      font-size: 28px;
      margin-bottom: 8px;
    }

    .test-header p {
      color: var(--text-secondary);
      font-size: 14px;
    }

    .current-year {
      color: var(--accent);
      font-weight: 600;
    }

    .test-checklist {
      background: var(--bg-secondary);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 20px;
    }

    .test-checklist h2 {
      font-size: 16px;
      margin-bottom: 12px;
      color: var(--text-primary);
    }

    .checklist-item {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 8px 0;
      border-bottom: 1px solid var(--border);
    }

    .checklist-item:last-child {
      border-bottom: none;
    }

    .check-icon {
      width: 20px;
      height: 20px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
    }

    .check-icon.pass {
      background: var(--success);
      color: white;
    }

    .check-icon.fail {
      background: var(--danger);
      color: white;
    }

    .check-icon.pending {
      background: var(--bg-tertiary);
      border: 2px solid var(--border);
    }

    .dashboard-container {
      max-width: 600px;
      margin: 0 auto;
    }

    /* Chart Section Styles */
    .chart-section {
      margin-bottom: 24px;
      background: var(--bg-secondary);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 16px;
    }

    .chart-section h3 {
      font-size: 14px;
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .chart-section h3 svg {
      width: 16px;
      height: 16px;
      color: var(--accent);
    }

    .chart-container {
      background: var(--bg-tertiary);
      border-radius: 8px;
      padding: 12px;
      position: relative;
    }

    .chart-canvas {
      width: 100% !important;
      height: 200px !important;
    }

    .daily-refresh-badge {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      margin-left: auto;
      padding: 4px 10px;
      background: var(--bg-tertiary);
      border: 1px solid var(--border);
      border-radius: 12px;
      font-size: 10px;
      font-weight: 500;
      color: var(--text-tertiary);
    }

    /* Stats Grid */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 10px;
      margin-top: 12px;
      padding-top: 12px;
      border-top: 1px solid var(--border);
    }

    .stat-item {
      text-align: center;
      padding: 10px;
      background: var(--bg-tertiary);
      border-radius: 8px;
    }

    .stat-label {
      display: block;
      font-size: 10px;
      color: var(--text-tertiary);
      margin-bottom: 4px;
      text-transform: uppercase;
    }

    .stat-value {
      font-size: 16px;
      font-weight: 700;
      color: var(--text-primary);
    }

    /* Detection Breakdown */
    .detection-breakdown {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 8px;
      margin-top: 12px;
    }

    .detection-item {
      text-align: center;
      padding: 10px;
      background: var(--bg-tertiary);
      border-radius: 8px;
    }

    .detection-dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      display: inline-block;
      margin-bottom: 6px;
    }

    .detection-label {
      display: block;
      font-size: 10px;
      color: var(--text-tertiary);
    }

    .detection-value {
      font-size: 16px;
      font-weight: 600;
      color: var(--text-primary);
      display: block;
    }

    /* Conversion Stats */
    .conversion-stats {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
      margin-top: 12px;
      padding-top: 12px;
      border-top: 1px solid var(--border);
    }

    .conversion-stat-item {
      text-align: center;
      padding: 10px;
      background: var(--bg-tertiary);
      border-radius: 8px;
    }

    .conversion-stat-label {
      display: block;
      font-size: 10px;
      color: var(--text-tertiary);
      margin-bottom: 4px;
      text-transform: uppercase;
    }

    .conversion-stat-value {
      font-size: 18px;
      font-weight: 700;
      color: var(--text-primary);
    }

    .conversion-stat-value.positive {
      color: var(--success);
    }

    /* Test Results */
    .test-results {
      background: var(--bg-secondary);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 20px;
      margin-top: 20px;
    }

    .test-results h2 {
      font-size: 16px;
      margin-bottom: 12px;
    }

    .result-summary {
      display: flex;
      gap: 20px;
      font-size: 14px;
    }

    .result-pass { color: var(--success); }
    .result-fail { color: var(--danger); }
  </style>
</head>
<body>
  <div class="dashboard-container">
    <div class="test-header">
      <h1>Founder Dashboard Test</h1>
      <p>Testing chart visibility and current year: <span class="current-year" id="currentYearDisplay">Loading...</span></p>
    </div>

    <!-- Test Checklist -->
    <div class="test-checklist" id="testChecklist">
      <h2>Test Checklist</h2>
      <div class="checklist-item" id="check-year">
        <span class="check-icon pending">?</span>
        <span>MRR Overview shows current year (<span id="expectedYear"></span>)</span>
      </div>
      <div class="checklist-item" id="check-mrr-chart">
        <span class="check-icon pending">?</span>
        <span>MRR Overview Chart is visible and rendered</span>
      </div>
      <div class="checklist-item" id="check-growth-chart">
        <span class="check-icon pending">?</span>
        <span>30-Day Growth Trend Chart is visible and rendered</span>
      </div>
      <div class="checklist-item" id="check-conversion-chart">
        <span class="check-icon pending">?</span>
        <span>Monthly Conversion Rate Chart is visible and rendered</span>
      </div>
      <div class="checklist-item" id="check-detection-chart">
        <span class="check-icon pending">?</span>
        <span>Detection Breakdown Chart is visible and rendered</span>
      </div>
      <div class="checklist-item" id="check-scrollable">
        <span class="check-icon pending">?</span>
        <span>All charts are accessible (visible or scrollable)</span>
      </div>
    </div>

    <!-- MRR Overview Chart -->
    <div class="chart-section" id="mrrChartSection">
      <h3>
        <svg viewBox="0 0 24 24" fill="none">
          <path d="M12 2v20M17 5H9.5a3.5 3.5 0 000 7h5a3.5 3.5 0 010 7H6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        <span id="mrrChartYear">2024</span> MRR Overview
        <span class="daily-refresh-badge">Daily refresh</span>
      </h3>
      <div class="chart-container">
        <canvas id="mrrChart" class="chart-canvas"></canvas>
      </div>
      <div class="stats-grid">
        <div class="stat-item">
          <span class="stat-label">Total YTD</span>
          <span class="stat-value" id="mrrTotalRevenue">$478.50</span>
        </div>
        <div class="stat-item">
          <span class="stat-label">Avg Monthly</span>
          <span class="stat-value" id="mrrAvgMonthly">$39.88</span>
        </div>
        <div class="stat-item">
          <span class="stat-label">Peak MRR</span>
          <span class="stat-value" id="mrrPeak">$63.92</span>
        </div>
        <div class="stat-item">
          <span class="stat-label">Growth</span>
          <span class="stat-value" id="mrrGrowthRate" style="color: #10B981;">+12.5%</span>
        </div>
      </div>
    </div>

    <!-- 30-Day Growth Trend -->
    <div class="chart-section" id="growthChartSection">
      <h3>
        <svg viewBox="0 0 24 24" fill="none">
          <path d="M3 3v18h18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M18 9l-5 5-4-4-5 5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        30-Day Growth Trend
      </h3>
      <div class="chart-container">
        <canvas id="growthChart" class="chart-canvas"></canvas>
      </div>
    </div>

    <!-- Monthly Conversion Rate -->
    <div class="chart-section" id="conversionChartSection">
      <h3>
        <svg viewBox="0 0 24 24" fill="none">
          <path d="M16 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <circle cx="8.5" cy="7" r="4" stroke="currentColor" stroke-width="2"/>
          <path d="M20 8v6M23 11h-6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        Monthly Conversion Rate
      </h3>
      <div class="chart-container">
        <canvas id="conversionChart" class="chart-canvas"></canvas>
      </div>
      <div class="conversion-stats">
        <div class="conversion-stat-item">
          <span class="conversion-stat-label">Current Rate</span>
          <span class="conversion-stat-value positive" id="convCurrentRate">4.2%</span>
        </div>
        <div class="conversion-stat-item">
          <span class="conversion-stat-label">This Month</span>
          <span class="conversion-stat-value" id="convThisMonth">3</span>
        </div>
        <div class="conversion-stat-item">
          <span class="conversion-stat-label">Avg Monthly</span>
          <span class="conversion-stat-value" id="convAvgMonthly">2.5</span>
        </div>
      </div>
    </div>

    <!-- Detection Breakdown -->
    <div class="chart-section" id="detectionChartSection">
      <h3>
        <svg viewBox="0 0 24 24" fill="none">
          <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        Detection Breakdown
      </h3>
      <div class="chart-container">
        <canvas id="detectionChart" class="chart-canvas" style="height: 150px !important;"></canvas>
        <div class="detection-breakdown">
          <div class="detection-item">
            <span class="detection-dot" style="background: #10B981;"></span>
            <span class="detection-value" id="detLegitimate">245</span>
            <span class="detection-label">Legitimate</span>
          </div>
          <div class="detection-item">
            <span class="detection-dot" style="background: #EF4444;"></span>
            <span class="detection-value" id="detScam">32</span>
            <span class="detection-label">Scam</span>
          </div>
          <div class="detection-item">
            <span class="detection-dot" style="background: #F59E0B;"></span>
            <span class="detection-value" id="detGhost">18</span>
            <span class="detection-label">Ghost</span>
          </div>
          <div class="detection-item">
            <span class="detection-dot" style="background: #8B5CF6;"></span>
            <span class="detection-value" id="detSpam">12</span>
            <span class="detection-label">Spam</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Test Results -->
    <div class="test-results" id="testResults">
      <h2>Test Results</h2>
      <div class="result-summary">
        <span class="result-pass">Passed: <span id="passCount">0</span></span>
        <span class="result-fail">Failed: <span id="failCount">0</span></span>
      </div>
    </div>
  </div>

  <script>
    // Global chart instances
    let mrrChart = null;
    let growthChart = null;
    let conversionChart = null;
    let detectionChart = null;

    // Test results tracking
    const testResults = {
      year: false,
      mrrChart: false,
      growthChart: false,
      conversionChart: false,
      detectionChart: false,
      scrollable: true
    };

    // Get current year
    const currentYear = new Date().getFullYear();

    // Initialize on page load
    document.addEventListener('DOMContentLoaded', function() {
      console.log('DOM loaded, initializing charts...');

      // Update year displays
      document.getElementById('currentYearDisplay').textContent = currentYear;
      document.getElementById('expectedYear').textContent = currentYear;
      document.getElementById('mrrChartYear').textContent = currentYear;

      // Check year test
      const yearDisplay = document.getElementById('mrrChartYear').textContent;
      testResults.year = (yearDisplay == currentYear);
      updateChecklistItem('check-year', testResults.year);

      // Initialize all charts with demo data
      initMRRChart();
      initGrowthChart();
      initConversionChart();
      initDetectionChart();

      // Check chart visibility after a short delay
      setTimeout(verifyCharts, 500);
    });

    function initMRRChart() {
      const ctx = document.getElementById('mrrChart');
      if (!ctx) {
        console.error('MRR chart canvas not found');
        return;
      }

      const monthNames = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
      const currentMonth = new Date().getMonth();

      // Generate demo data for current year up to current month
      const actualData = monthNames.map((_, i) => {
        if (i <= currentMonth) {
          return Math.round((15 + Math.random() * 50) * 100) / 100;
        }
        return null;
      });

      const projectedData = monthNames.map((_, i) => {
        if (i > currentMonth) {
          return Math.round((30 + Math.random() * 40) * 100) / 100;
        }
        return i === currentMonth ? actualData[i] : null;
      });

      try {
        mrrChart = new Chart(ctx, {
          type: 'bar',
          data: {
            labels: monthNames,
            datasets: [
              {
                label: 'Actual MRR',
                data: actualData,
                backgroundColor: '#10B981',
                borderColor: '#059669',
                borderWidth: 1,
                borderRadius: 6,
              },
              {
                label: 'Projected MRR',
                data: projectedData,
                backgroundColor: 'rgba(16, 185, 129, 0.3)',
                borderColor: 'rgba(16, 185, 129, 0.5)',
                borderWidth: 1,
                borderRadius: 6,
              }
            ]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                display: true,
                position: 'top',
                labels: { color: '#a1a1aa', font: { size: 10 } }
              }
            },
            scales: {
              x: { grid: { display: false }, ticks: { color: '#71717a', font: { size: 10 } } },
              y: {
                grid: { color: 'rgba(255,255,255,0.1)' },
                ticks: {
                  color: '#71717a',
                  font: { size: 10 },
                  callback: (v) => '$' + v
                },
                beginAtZero: true
              }
            }
          }
        });
        console.log('MRR chart initialized successfully');
        testResults.mrrChart = true;
      } catch (e) {
        console.error('MRR chart error:', e);
        testResults.mrrChart = false;
      }
    }

    function initGrowthChart() {
      const ctx = document.getElementById('growthChart');
      if (!ctx) {
        console.error('Growth chart canvas not found');
        return;
      }

      // Generate 30 days of demo data
      const labels = [];
      const users = [];
      const scans = [];
      for (let i = 29; i >= 0; i--) {
        const date = new Date();
        date.setDate(date.getDate() - i);
        labels.push(date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' }));
        users.push(Math.floor(5 + Math.random() * 20));
        scans.push(Math.floor(10 + Math.random() * 50));
      }

      try {
        growthChart = new Chart(ctx, {
          type: 'line',
          data: {
            labels,
            datasets: [
              {
                label: 'Active Users',
                data: users,
                borderColor: '#8B5CF6',
                backgroundColor: 'rgba(139, 92, 246, 0.1)',
                fill: true,
                tension: 0.4,
                pointRadius: 0,
              },
              {
                label: 'Scans',
                data: scans,
                borderColor: '#10B981',
                backgroundColor: 'rgba(16, 185, 129, 0.1)',
                fill: true,
                tension: 0.4,
                pointRadius: 0,
              }
            ]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                display: true,
                position: 'top',
                labels: { color: '#a1a1aa', font: { size: 10 } }
              }
            },
            scales: {
              x: { grid: { color: 'rgba(255,255,255,0.1)' }, ticks: { color: '#71717a', font: { size: 9 }, maxTicksLimit: 7 } },
              y: { grid: { color: 'rgba(255,255,255,0.1)' }, ticks: { color: '#71717a', font: { size: 10 } }, beginAtZero: true }
            }
          }
        });
        console.log('Growth chart initialized successfully');
        testResults.growthChart = true;
      } catch (e) {
        console.error('Growth chart error:', e);
        testResults.growthChart = false;
      }
    }

    function initConversionChart() {
      const ctx = document.getElementById('conversionChart');
      if (!ctx) {
        console.error('Conversion chart canvas not found');
        return;
      }

      const currentMonth = new Date().getMonth();
      const monthNames = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
      const labels = monthNames.slice(0, currentMonth + 1);
      const rates = labels.map(() => Math.round((1 + Math.random() * 5) * 10) / 10);

      try {
        conversionChart = new Chart(ctx, {
          type: 'line',
          data: {
            labels,
            datasets: [{
              label: 'Conversion Rate',
              data: rates,
              borderColor: '#8B5CF6',
              backgroundColor: 'rgba(139, 92, 246, 0.1)',
              fill: true,
              tension: 0.4,
              pointBackgroundColor: '#8B5CF6',
              pointBorderColor: '#fff',
              pointBorderWidth: 2,
              pointRadius: 4,
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: { legend: { display: false } },
            scales: {
              x: { grid: { display: false }, ticks: { color: '#71717a', font: { size: 10 } } },
              y: {
                grid: { color: 'rgba(255,255,255,0.1)' },
                ticks: { color: '#71717a', font: { size: 10 }, callback: (v) => v + '%' },
                beginAtZero: true,
                suggestedMax: 10
              }
            }
          }
        });
        console.log('Conversion chart initialized successfully');
        testResults.conversionChart = true;
      } catch (e) {
        console.error('Conversion chart error:', e);
        testResults.conversionChart = false;
      }
    }

    function initDetectionChart() {
      const ctx = document.getElementById('detectionChart');
      if (!ctx) {
        console.error('Detection chart canvas not found');
        return;
      }

      try {
        detectionChart = new Chart(ctx, {
          type: 'doughnut',
          data: {
            labels: ['Legitimate', 'Scam', 'Ghost', 'Spam'],
            datasets: [{
              data: [245, 32, 18, 12],
              backgroundColor: ['#10B981', '#EF4444', '#F59E0B', '#8B5CF6'],
              borderWidth: 0,
              hoverOffset: 4
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            cutout: '65%',
            plugins: {
              legend: { display: false }
            }
          }
        });
        console.log('Detection chart initialized successfully');
        testResults.detectionChart = true;
      } catch (e) {
        console.error('Detection chart error:', e);
        testResults.detectionChart = false;
      }
    }

    function verifyCharts() {
      console.log('Verifying chart visibility...');

      // Check if chart canvases have rendered content
      const mrrCanvas = document.getElementById('mrrChart');
      const growthCanvas = document.getElementById('growthChart');
      const conversionCanvas = document.getElementById('conversionChart');
      const detectionCanvas = document.getElementById('detectionChart');

      // Check canvas dimensions (rendered charts have proper dimensions)
      testResults.mrrChart = mrrCanvas && mrrCanvas.offsetWidth > 0 && mrrCanvas.offsetHeight > 0;
      testResults.growthChart = growthCanvas && growthCanvas.offsetWidth > 0 && growthCanvas.offsetHeight > 0;
      testResults.conversionChart = conversionCanvas && conversionCanvas.offsetWidth > 0 && conversionCanvas.offsetHeight > 0;
      testResults.detectionChart = detectionCanvas && detectionCanvas.offsetWidth > 0 && detectionCanvas.offsetHeight > 0;

      // Update checklist
      updateChecklistItem('check-mrr-chart', testResults.mrrChart);
      updateChecklistItem('check-growth-chart', testResults.growthChart);
      updateChecklistItem('check-conversion-chart', testResults.conversionChart);
      updateChecklistItem('check-detection-chart', testResults.detectionChart);
      updateChecklistItem('check-scrollable', testResults.scrollable);

      // Update results summary
      const passCount = Object.values(testResults).filter(v => v).length;
      const failCount = Object.values(testResults).filter(v => !v).length;
      document.getElementById('passCount').textContent = passCount;
      document.getElementById('failCount').textContent = failCount;

      console.log('Test Results:', testResults);
      console.log(`Passed: ${passCount}, Failed: ${failCount}`);
    }

    function updateChecklistItem(id, passed) {
      const item = document.getElementById(id);
      if (item) {
        const icon = item.querySelector('.check-icon');
        icon.classList.remove('pending', 'pass', 'fail');
        icon.classList.add(passed ? 'pass' : 'fail');
        icon.textContent = passed ? '✓' : '✗';
      }
    }
  </script>
</body>
</html>
